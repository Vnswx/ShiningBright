<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>detail Product</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link rel="stylesheet" href="Assets/Shopping/css/style.css" />
</head>

<body>
    <!-- Navbar -->
    <nav>
        <div class="left-nav">
            <div class="logo">
                <a href="index.html">
                    <img src="Assets/assetnavbarhero/logosb.png" alt="Shinning Bright Logo" />
                </a>
            </div>

            <!-- <div class="nav-links">
          <a href="#">SHOP</a>
          <a href="#">NEW ARRIVALS</a>
          <a href="#">ABOUT</a>
          <a href="#">CONTACT</a>
        </div> -->
        </div>
        <!-- <div class="cart2-mobile">
            <img
              class="search"
              src="Assets/assetnavbarhero/search.svg"
              alt="Search Icon"
            />
            <img
              class="cart-icon"
              src="Assets/assetnavbarhero/shop.svg"
              alt="Cart Icon"
            />
          </div> -->
        <div class="cart">
            <div class="cart2">
                <img class="search" src="Assets/assetnavbarhero/search.svg" alt="Search Icon" />
                <a href="payment.html"><img src="Assets/assetnavbarhero/shop.svg" alt="Cart Icon" /></a>
            </div>

            <div class="menu-toggle" id="menu-toggle">☰</div>
        </div>
    </nav>

    <!-- SEARCH OVERLAY -->
    <div class="search-overlay">
        <!-- SEARCH BOX (atas) -->
        <div class="search-box">
            <img src="Assets/assetnavbarhero/search.svg" class="search-btn" alt="search" />
            <input type="text" id="searchInput" placeholder="Search product..." />
            <span class="close-search">&times;</span>
        </div>

        <!-- SEARCH RESULT -->
        <div class="search-result" id="searchResult">
            <h4>Products</h4>
            <p class="empty">Type to search products</p>
        </div>

        <!-- SEARCH CONTENT -->
        <div class="search-content" id="searchContent">
            <!-- Popular Search -->
            <div class="search-section">
                <h4>Popular Search Terms</h4>
                <div class="search-tags">
                    <button data-category="T-Shirt">T-Shirt</button>
                    <button data-category="Jacket">Jacket</button>
                    <button data-category="Shirt">Shirt</button>
                    <button data-category="Hoodie">Hoodie</button>
                    <button data-category="Crewneck">Crewneck</button>
                    <button data-category="Jeans">LongPants</button>
                    <button data-category="Underwear">Underwear</button>
                </div>
            </div>

            <!-- Recent Viewed -->
            <div class="search-section">
                <h4>Recent Viewed</h4>
                <div class="recent-products" id="recentProducts"></div>
            </div>
        </div>
    </div>

    <div class="product-container">
        <!-- LEFT SIDE -->
        <div class="left-section">
            <div class="main-image">
                <img id="mainImage" src="" alt="" />
            </div>

            <div id="thumbnailList" class="thumbnail-list"></div>
        </div>

        <div class="right-section">
            <span id="tag1" class="tag"></span>
            <span id="tag2" class="tag yellow"></span>

            <h2 id="productName"></h2>

            <div class="price">
                <span id="oldPrice" class="old"></span>
                <span id="newPrice" class="new"></span>
                <span id="discount" class="discount"></span>
            </div>

            <div id="sizeList" class="size-list"></div>

            <div class="size-chart">
                <h3>Size Chart</h3>
                <table>
                    <tr>
                        <th>Size</th>
                        <th>S</th>
                        <th>M</th>
                        <th>L</th>
                        <th>XL</th>
                        <th>XXL</th>
                    </tr>
                    <tr>
                        <td>Length</td>
                        <td>62</td>
                        <td>64</td>
                        <td>66</td>
                        <td>68</td>
                        <td>70</td>
                    </tr>
                    <tr>
                        <td>Width</td>
                        <td>56</td>
                        <td>58</td>
                        <td>60</td>
                        <td>62</td>
                        <td>64</td>
                    </tr>
                    <tr>
                        <td>Sleeves</td>
                        <td>50</td>
                        <td>52</td>
                        <td>54</td>
                        <td>56</td>
                        <td>58</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <section class="product-section">
        <h5 style="margin-bottom: 20px">You Might Also Like</h5>

        <div class="row g-4" id="relatedList" style="margin-bottom: 130px"></div>
    </section>

    <div class="music-card">
        <div class="music-info">
            <h4 id="musicTitle">Nosstreess - Pegang tanganku</h4>
        </div>
        <div class="music-controls">
            <button id="prevBtn">⏮</button>
            <button id="playPauseBtn">⏸</button>
            <button id="nextBtn">⏭</button>
        </div>

        <audio id="audioPlayer" src="Assets/music/music.mp3"></audio>
    </div>


    <!-- Ini footernyaa kawann -->
    <footer>
        <div class="container footer">
            <div class="row justify-content-between">
                <div class="col-6 col-md-3 col-lg-2 mb-4">
                    <h6>FEATURES</h6>
                    <ul>
                        <li><a href="#">SHOP</a></li>
                        <li><a href="#">NEW ARRIVALS</a></li>
                        <li><a href="#">ABOUT</a></li>
                        <li><a href="#">CONTACT US</a></li>
                    </ul>
                </div>

                <div class="col-6 col-md-3 col-lg-2 mb-4">
                    <h6>PRODUK</h6>
                    <ul>
                        <li><a href="#">T-SHIRT</a></li>
                        <li><a href="#">JACKET</a></li>
                        <li><a href="#">SHIRT</a></li>
                        <li><a href="#">HOODIE</a></li>
                        <li><a href="#">CREWNECK</a></li>
                        <li><a href="#">LONG PANTS</a></li>
                        <li><a href="#">UNDERWEAR</a></li>
                    </ul>
                </div>

                <div class="col-12 col-md-4 col-lg-3 mb-4">
                    <h6>PAYMENT METHOD</h6>
                    <div class="payment-img">
                        <img src="Assets/Shopping/img/payment.png" alt="Payment Methods" />
                    </div>
                </div>

                <div class="col-12 col-md-5 col-lg-4">
                    <h5 class="footer-brand">SHINNING<span>BRIGHT.</span></h5>

                    <h6>FOLLOW ME</h6>

                    <div class="social-icons mb-3">
                        <i class="bi bi-instagram"></i>
                        <i class="bi bi-tiktok"></i>
                        <i class="bi bi-youtube"></i>
                        <i class="bi bi-facebook"></i>
                    </div>

                    <div class="contact-info mb-3">
                        <h6>CONTACT US</h6>
                        <p>089531432748</p>
                        <a href="mailto:shinningbright@gmail.com">shinningbright@gmail.com</a>
                        <hr style="border: 1px solid black; width: 75%; margin-top: 6px" />
                    </div>

                    <div class="store-info">
                        <h6>STORE OFFLINE</h6>
                        <p><strong>Tangerang Selatan</strong></p>
                        <p>
                            Jl. Jombang Raya No.97, Pd. Pucung, Kec. Pd. Aren, Kota
                            Tangerang Selatan, Banten 15227
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script src="Assets/Shopping/js/general.js"></script>
    <script src="Assets/Shopping/js/data.js"></script>
    <script src="Assets/Shopping/js/search.js"></script>
    <script src="Assets/Homepage/js/landingpage.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get("id");

        // Pastikan variabel ini bisa diakses script lain
        const currentProduct = products.find((p) => p.id === productId);

        if (!currentProduct) {
            console.error("Produk tidak ditemukan!");
            // Opsional: arahkan balik ke index jika produk tidak ada
            // window.location.href = 'index.html'; 
        } else {
            // Render Detail Produk
            document.getElementById("productName").textContent = currentProduct.name;
            document.getElementById("oldPrice").textContent = "Rp " + currentProduct.oldPrice.toLocaleString();
            document.getElementById("newPrice").textContent = "Rp " + currentProduct.newPrice.toLocaleString();
            document.getElementById("discount").textContent = currentProduct.discount + "%";

            document.getElementById("tag1").textContent = currentProduct.tag1 || "";
            document.getElementById("tag2").textContent = currentProduct.tag2 || "";

            document.getElementById("mainImage").src = currentProduct.images[0];

            // Render Thumbnails
            const thumbnailList = document.getElementById("thumbnailList");
            thumbnailList.innerHTML = "";
            currentProduct.images.forEach((img) => {
                let thumb = document.createElement("img");
                thumb.src = img;
                thumb.onclick = () => (document.getElementById("mainImage").src = img);
                thumbnailList.appendChild(thumb);
            });

            // Render Size List
            const sizeContainer = document.getElementById("sizeList");
            sizeContainer.innerHTML = "";

            currentProduct.sizes.forEach((item) => {
                const isSoldOut = item.stock === 0;
                const isLowStock = item.stock > 0 && item.stock <= 3;

                const row = document.createElement("div");
                row.classList.add("size-item");
                if (isSoldOut) row.classList.add("soldout");

                let stockText = isSoldOut
                    ? "(Sold Out)"
                    : isLowStock
                        ? `(Low Stock: ${item.stock})`
                        : `(Stock: ${item.stock})`;

                row.innerHTML = `
                  <span>${item.size}</span>
                  <span>Rp ${item.price.toLocaleString()} ${stockText}</span>
                  <button ${isSoldOut ? "disabled" : ""} class="btn-buy">Buy</button>
                `;

                row.querySelector("button").addEventListener("click", () => {
                    addToCart(currentProduct, item);
                });

                sizeContainer.appendChild(row);
            });

            // Fungsi Tambah ke Cart (Pastikan elemen .product-list ada di HTML)
            function addToCart(product, sizeItem) {
                // 1. Ambil data keranjang yang sudah ada di LocalStorage (jika belum ada, buat array kosong)
                let cart = JSON.parse(localStorage.getItem("shoppingCart")) || [];

                // 2. Siapkan data produk baru
                const newItem = {
                    id: product.id + sizeItem.size, // Gabungan ID dan Size agar unik
                    name: product.name,
                    size: sizeItem.size,
                    quantity: 1,
                    price: sizeItem.price
                };

                // 3. Cek apakah barang yang sama dengan size yang sama sudah ada di keranjang?
                const existingItemIndex = cart.findIndex(item => item.id === newItem.id);

                if (existingItemIndex > -1) {
                    // Jika sudah ada, cukup tambah jumlahnya (Quantity)
                    cart[existingItemIndex].quantity += 1;
                } else {
                    // Jika belum ada, masukkan sebagai barang baru
                    cart.push(newItem);
                }

                // 4. Simpan kembali daftar terbaru ke LocalStorage
                localStorage.setItem("shoppingCart", JSON.stringify(cart));

                // 5. Alert saja, jangan pindah halaman
                alert(`${product.name} (Size ${sizeItem.size}) ditambahkan ke keranjang!`);
            }

            // Render Related Products
            const relatedBox = document.getElementById("relatedList");
            relatedBox.innerHTML = "";

            let related = products.filter(p => p.category === currentProduct.category && p.id !== currentProduct.id);

            if (related.length < 6) {
                const others = products.filter(p => p.id !== currentProduct.id);
                others.forEach(o => {
                    if (related.length < 6 && !related.find(r => r.id === o.id)) {
                        related.push(o);
                    }
                });
            }

            related.slice(0, 6).forEach((item) => {
                let col = document.createElement("div");
                col.className = "col-6 col-md-3 col-lg-2";
                col.innerHTML = `
                  <div class="related-item" style="cursor:pointer" onclick="window.location.href='detailProduct.html?id=${item.id}'">
                    <img src="${item.images[0]}" class="related-img" style="width:100%">
                    <div class="related-info">
                      <h6 class="mt-2">${item.name}</h6>
                      <p class="old text-muted text-decoration-line-through" style="font-size:0.8rem">Rp ${item.oldPrice.toLocaleString()}</p>
                      <p class="new text-danger fw-bold">Rp ${item.newPrice.toLocaleString()}</p>
                    </div>
                  </div>
                `;
                relatedBox.appendChild(col);
            });
        }
    </script>

    <script>
        // Logic Recent Products
        const RECENT_KEY = "recent_products";
        const MAX_RECENT = 9;

        function saveRecentProduct(product) {
            let recent = JSON.parse(localStorage.getItem(RECENT_KEY)) || [];
            // Hapus jika sudah ada (supaya pindah ke paling atas)
            recent = recent.filter((item) => item.id !== product.id);
            // Tambah ke awal array
            recent.unshift({
                id: product.id,
                name: product.name,
                images: [product.images[0]],
                newPrice: product.newPrice,
                oldPrice: product.oldPrice
            });
            // Batasi jumlah
            recent = recent.slice(0, MAX_RECENT);
            localStorage.setItem(RECENT_KEY, JSON.stringify(recent));
        }

        if (typeof currentProduct !== 'undefined' && currentProduct) {
            saveRecentProduct(currentProduct);
        }
    </script>
</body>

</html>